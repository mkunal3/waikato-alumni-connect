generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 Int       @id @default(autoincrement())
  email              String    @unique
  name               String
  role               String
  createdAt          DateTime  @default(now())
  approvalStatus     String    @default("pending")
  passwordHash       String
  currentCompany     String?
  currentPosition    String?
  degree             String?
  graduationYear     Int?
  mentoringGoals     String[]
  skillsOffered      String[]
  skillsWanted       String[]
  studentId          String?
  yearOfStudy        Int?
  academicFocus      String?
  cvFileName         String?
  cvFilePath         String?
  cvUploadedAt       DateTime?
  expectedGraduation String?
  about              String?
  location           String?
  linkedInUrl        String?
  githubUrl          String?
  portfolioUrl       String?
  gpa                String?
  languages          String[]
  interests          String[]
  workExperience     Json?
  projects           Json?
  certifications     Json?
  contactEmail       String?
  alumniMatches      Match[]   @relation("AlumniMatches")
  confirmedMatches   Match[]   @relation("ConfirmedMatches")
  studentMatches     Match[]   @relation("StudentMatches")
  sentMessages       Message[]
}

model Match {
  id            Int       @id @default(autoincrement())
  studentId     Int
  alumniId      Int
  status        String    @default("pending")
  matchScore    Float?
  matchReasons  String[]
  coverLetter   String?
  confirmedById Int?
  confirmedAt   DateTime?
  createdAt     DateTime  @default(now())
  alumni        User      @relation("AlumniMatches", fields: [alumniId], references: [id], onDelete: Cascade)
  confirmedBy   User?     @relation("ConfirmedMatches", fields: [confirmedById], references: [id])
  student       User      @relation("StudentMatches", fields: [studentId], references: [id], onDelete: Cascade)
  messages      Message[]

  @@unique([studentId, alumniId])
}

model Message {
  id        Int      @id @default(autoincrement())
  matchId   Int
  senderId  Int
  content   String
  createdAt DateTime @default(now())
  match     Match    @relation(fields: [matchId], references: [id], onDelete: Cascade)
  sender    User     @relation(fields: [senderId], references: [id], onDelete: Cascade)

  @@index([matchId])
  @@index([createdAt])
}

model EmailVerification {
  id        Int       @id @default(autoincrement())
  email     String
  code      String
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime  @default(now())

  @@index([email])
  @@index([expiresAt])
}

model InvitationCode {
  id        Int      @id @default(autoincrement())
  code      String   @unique
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
