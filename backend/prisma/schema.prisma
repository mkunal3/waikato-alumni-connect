datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// OLD USER MODEL - DEPRECATED
// model User {
//   id            Int      @id @default(autoincrement())
//   name          String
//   email         String   @unique
//   role          String   // student / alumni / admin
//   passwordHash  String
//   approvalStatus String  @default("pending") // pending / approved / rejected
//   createdAt     DateTime @default(now())
// }

model User {
  id             Int      @id @default(autoincrement())
  name           String
  email          String   @unique
  role           String // student / alumni / admin
  passwordHash   String
  approvalStatus String   @default("pending") // pending / approved / rejected
  createdAt      DateTime @default(now())

  // Student-specific fields
  studentId   String?
  degree      String?
  yearOfStudy Int?

  // Alumni-specific fields
  graduationYear  Int?
  currentCompany  String?
  currentPosition String?

  // Additional profile fields
  expectedGraduation String?
  academicFocus      String?
  cvFileName         String?
  cvFilePath         String?
  cvUploadedAt       DateTime?

  // Matching fields (JSON arrays)
  mentoringGoals String[] // Career goals, skill development, etc.
  skillsOffered  String[] // Skills alumni can teach
  skillsWanted   String[] // Skills students want to learn

  // Relations
  studentMatches   Match[] @relation("StudentMatches")
  alumniMatches    Match[] @relation("AlumniMatches")
  confirmedMatches Match[] @relation("ConfirmedMatches")
}

model Match {
  id            Int       @id @default(autoincrement())
  studentId     Int
  alumniId      Int
  status        String    @default("pending") // pending / confirmed / completed / ended
  matchScore    Float? // 0-100 compatibility score
  matchReasons  String[] // Why this match was suggested
  confirmedById Int? // Admin user who confirmed the match
  confirmedAt   DateTime?
  createdAt     DateTime  @default(now())

  // Relations
  student     User  @relation("StudentMatches", fields: [studentId], references: [id], onDelete: Cascade)
  alumni      User  @relation("AlumniMatches", fields: [alumniId], references: [id], onDelete: Cascade)
  confirmedBy User? @relation("ConfirmedMatches", fields: [confirmedById], references: [id], onDelete: SetNull)

  @@unique([studentId, alumniId])
}

model EmailVerification {
  id        Int       @id @default(autoincrement())
  email     String
  code      String
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime  @default(now())

  @@index([email])
  @@index([expiresAt])
}

model InvitationCode {
  id        Int      @id @default(autoincrement())
  code      String   @unique
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
